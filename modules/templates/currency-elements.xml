<!--
  ~ Copyright (C) 2023 Xibo Signage Ltd
  ~
  ~ Xibo - Digital Signage - https://xibosignage.com
  ~
  ~ This file is part of Xibo.
  ~
  ~ Xibo is free software: you can redistribute it and/or modify
  ~ it under the terms of the GNU Affero General Public License as published by
  ~ the Free Software Foundation, either version 3 of the License, or
  ~ any later version.
  ~
  ~ Xibo is distributed in the hope that it will be useful,
  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~ GNU Affero General Public License for more details.
  ~
  ~ You should have received a copy of the GNU Affero General Public License
  ~ along with Xibo.  If not, see <http://www.gnu.org/licenses/>.
  -->
<templates>
    <template>
        <id>currency_name</id>
        <extends override="text" with="data.NameShort">text</extends>
        <title>Currency Name</title>
        <type>element</type>
        <dataType>currency</dataType>
        <canRotate>true</canRotate>
        <thumbnail>currency-name</thumbnail>
        <startWidth>360</startWidth>
        <startHeight>100</startHeight>
        <assets>
            <asset id="currency-name" type="path" cmsOnly="true" mimeType="image/png" path="/modules/assets/template-thumbnails/currency/elements/currency-name.png" />
        </assets>
    </template>
    <template>
        <id>currency_rawLastTradePriceOnly</id>
        <extends override="text" with="data.RawLastTradePriceOnly">text</extends>
        <title>Last Trade Price</title>
        <type>element</type>
        <dataType>currency</dataType>
        <canRotate>true</canRotate>
        <thumbnail>currency-last-trade-price</thumbnail>
        <startWidth>250</startWidth>
        <startHeight>100</startHeight>
        <assets>
            <asset id="currency-last-trade-price" type="path" cmsOnly="true" mimeType="image/png" path="/modules/assets/template-thumbnails/currency/elements/currency-last-trade-price.png" />
        </assets>
    </template>
    <template>
        <id>currency_changePercentage</id>
        <extends override="text" with="data.ChangePercentage">text</extends>
        <title>Change Percentage</title>
        <type>element</type>
        <dataType>currency</dataType>
        <canRotate>true</canRotate>
        <thumbnail>currency-change-percentage</thumbnail>
        <startWidth>200</startWidth>
        <startHeight>100</startHeight>
        <onElementParseData><![CDATA[
// value - element to be parsed
if (String(value).length === 0) {
    return '';
}

if (String(value).includes('%')) {
    return value;
}

return value + '%';
]]></onElementParseData>
        <onTemplateRender><![CDATA[
var elementData = null;
if (properties.hasOwnProperty('data')) {
    elementData = properties.data;
}

if (elementData !== null && elementData.hasOwnProperty('ChangeStyle')) {
    var changeStyle = elementData.ChangeStyle;
    var $changePercent = $(target).find('div:first');

    if (changeStyle === 'value-equal') {
        $changePercent.css({color: 'gray'});
    } else {
        $changePercent.css({color: changeStyle === 'value-down' ? 'red' : 'green'});
    }
}
]]></onTemplateRender>
        <assets>
            <asset id="currency-change-percentage" type="path" cmsOnly="true" mimeType="image/png" path="/modules/assets/template-thumbnails/currency/elements/currency-change-percentage.png" />
        </assets>
    </template>
    <template>
        <id>currency_changeIcon</id>
        <title>Change Icon</title>
        <type>element</type>
        <dataType>currency</dataType>
        <canRotate>true</canRotate>
        <thumbnail>currency-change-icon</thumbnail>
        <startWidth>80</startWidth>
        <startHeight>60</startHeight>
        <stencil>
            <hbs><![CDATA[
<div class="arrow"><div class="fa {{data.ChangeIcon}}
    {{#eq data.ChangeIcon "up-arrow"}}fa-caret-up{{/eq}}
    {{#eq data.ChangeIcon "down-arrow"}}fa-caret-down{{/eq}}
    {{#eq data.ChangeIcon "right-arrow"}}fa-caret-right{{/eq}}"></div></div>
<style>
.arrow {
    width: 100%;
    height: 100%;
    position: relative;
    display: inline-block;
    text-align: center;
}

.arrow .fa {
    font-size: calc({{prop.width}}px * 0.75);
    {{#if prop.height}}line-height: {{prop.height}}px;{{/if}}
}

.down-arrow {
    color: red;
}

.up-arrow {
    color: green;
}

.right-arrow {
    color: gray;
}
</style>
]]></hbs>
        </stencil>
        <assets>
            <asset id="currency-change-icon" type="path" cmsOnly="true" mimeType="image/png" path="/modules/assets/template-thumbnails/currency/elements/currency-change-icon.png" />
        </assets>
    </template>
    <template>
        <id>currency_logo</id>
        <extends override="url" with="data.NameShort">global-image</extends>
        <title>Currency Logo</title>
        <type>element</type>
        <dataType>currency</dataType>
        <canRotate>true</canRotate>
        <thumbnail>currency-logo</thumbnail>
        <startWidth>100</startWidth>
        <startHeight>100</startHeight>
        <stencil>
            <hbs><![CDATA[
<div id="currency-logo-{{uniqueID}}" class="currency-logo" data-css-url="[[assetId=flagsCSS]]">
    <div class="img-circle center-block flag-icon-container">
        <img src="[[assetId=flags]]" class="flag-icon flag-icon-{{url}}">
    </div>
</div>
<style>
#currency-logo-{{uniqueID}} {
    overflow: hidden;
    width: 100%;
    height: 100%;
}
#currency-logo-{{uniqueID}} .img-circle {
    border-radius: 50%;
    vertical-align: middle;
    border: 0;
    height: 100%;
}
#currency-logo-{{uniqueID}} .center-block {
    display: block;
    margin-right: auto;
    margin-left: auto;
    top: 50%;
    transform: translateY(-50%);
}
</style>
            ]]></hbs>
        </stencil>
        <onTemplateRender><![CDATA[
// Width and Height of the element
const width = $(target).width();
const height = $(target).height();

const $logoContainer = $(target).find('.currency-logo');
const $imageContainer = $(target).find('.img-circle');

// Inject CSS into target container if it's not added yet
if ($(target).parent().parent().find('.sampleCSS').length == 0) {
    $(target).parent().parent().prepend(`<link rel="stylesheet" href="${$logoContainer.data('cssUrl')}" class="sampleCSS" media="screen"/>`)
}

// Scale image to the container
if (width > height) {
    $imageContainer.css('width', height);
    $imageContainer.css('height', '100%');
} else {
    $imageContainer.css('height', width);
    $imageContainer.css('width', '100%');
}
        ]]></onTemplateRender>
        <assets>
            <asset id="currency-logo" type="path" cmsOnly="true" mimeType="image/png" path="/modules/assets/template-thumbnails/currency/elements/currency-logo.png" />
            <asset id="flags" type="path" mimeType="image/webp" path="/modules/assets/currency/flags.webp" />
            <asset id="flagsCSS" type="path" mimeType="text/css" path="/modules/assets/currency/flags.css" />
        </assets>
    </template>
</templates>
